---
title: FFT快速傅里叶变换
tags:  [FFT, octave, 快速傅里叶变换]
layout: post
description: 
comments: true
categories: 天灵硕火
published: true
mermaid: false
mathjax: true
date: 2017-11-18 14:00:01 +0900
---

## 理解FFT

在开发天灵硕火时，不免要涉及到音频特征的提取。而音频的特征就包含在音频的频谱空间（频域）中，FFT（快速离散傅立叶变换），可以将一个信号快速变换到频域。

先科普相关概念，可以参考这篇文章：
[如果看了此文你还不懂傅里叶变换，那就过来掐死我吧【完整版】](http://blog.jobbole.com/70549/)

虽然有了基本概念，但是要想完全理解FFT还是得通过亲自实验一下，看看频谱的威力。

假设我们有一个信号，它含有2V的直流分量，频率为50Hz、
相位为-30度、幅度为3V的交流信号，以及一个频率为75Hz、
相位为90度、幅度为1.5V的交流信号。

用数学表达式就是如下（t为时间）：

$$
S=2+3\cos(2\pi50t-\frac{30}{180}\pi)+1.5\cos(2\pi75t+\frac{90}{180}\pi)
$$

式中cos参数为弧度，所以-30度和90度要分别换算成弧度。
我们以256Hz的采样率对这个信号进行采样，总共采样256点。
按照我们上面的分析，Fn=(n-1)*Fs/N，我们可以知道，每两个
点之间的间距就是1Hz，第n个点的频率就是n-1。我们的信号
有3个频率：0Hz、50Hz、75Hz，应该分别在第1个点、第51个点、
第76个点上出现峰值，其它各点应该接近0。实际情况如何呢？

在octave中输入以下代码：

```matlab
% 假设我们有一个信号，它含有2V的直流分量，频率为50Hz、
% 相位为-30度、幅度为3V的交流信号，以及一个频率为75Hz、
% 相位为90度、幅度为1.5V的交流信号。

Frequence1=50;  %  频率1
Frequence2=75;  %  频率2
FrequenceSampling=256;   %  采样频率
TimeSampling = 1/FrequenceSampling;  %  采样间隔
NumberSampling=FrequenceSampling*1;    %  采样数 1秒
Tx = (0: NumberSampling-1) * TimeSampling;

Vy = 2 + 3 * cos(2 * pi * 50 * Tx + 30 / 180 * pi) + 1.5 * cos(2 * pi * 75 * Tx + 90 / 180 * pi);

figure(1)
subplot(3,1,1)
plot(Tx, Vy);         % 直接输出信号
title('wave sample for 0Hz, 50Hz, 75Hz');
xlabel("Time (Sec)");
ylabel('voltage (V)');
grid;

subplot(3,1,2);
FFTy = fft(Vy);
Fx = (FrequenceSampling/NumberSampling)*(0:(NumberSampling/2));
Ay = (FFTy/NumberSampling);
Ay = Ay(1:NumberSampling/2+1);
Ay(2:end-1) = 2*Ay(2:end-1);  % 第一个点是直流，不需要乘以2，第二个点开始需要乘以2得到正确的幅值。
plot(Fx, abs(Ay));          % 输出幅值，频谱
title('Amplitude Spectrum');
xlabel("Frequence (Hz)");
ylabel("voltage (V)");
grid;

subplot(3,1,3);
phs = angle(Ay);          % 计算相位
plot(Fx,phs/pi*180);      % 输出相位
title('Phase Spectrum');
xlabel 'Frequency (Hz)';
ylabel 'Phase (deg)';
grid;
```

运行结果：

![](/assets/images/FFT-2017-11-18-17-45-21.png)

从图中我们可以看到，在第1点、第51点、和第76点附近有
比较大的值。我们分别将这三个点附近的数据拿上来细看：
1点： 512+0i
2点： -2.6195E-14 - 1.4162E-13i 
3点： -2.8586E-14 - 1.1898E-13i

50点：-6.2076E-13 - 2.1713E-12i
51点：332.55 - 192i
52点：-1.6707E-12 - 1.5241E-12i

75点：-2.2199E-13 -1.0076E-12i
76点：3.4315E-12 + 192i
77点：-3.0263E-14 +7.5609E-13i

很明显，1点、51点、76点的值都比较大，它附近的点值
都很小，可以认为是0，即在那些频率点上的信号幅度为0。
接着，我们来计算各点的幅度值。分别计算这三个点的模值，
结果如下：
1点： 512
51点：384
76点：192

按照公式，可以计算出
直流分量为：512/N=512/256=2
50Hz信号的幅度为：384/(N/2)=384/(256/2)=3
75Hz信号的幅度为192/(N/2)=192/(256/2)=1.5

可见，从频谱分析出来的幅度是正确的。

然后再来计算相位信息。直流信号没有相位可言，不用管
它。先计算50Hz信号的相位，atan2(-192, 332.55)=-0.5236,
结果是弧度，换算为角度就是180*(-0.5236)/pi=-30.0001。再
计算75Hz信号的相位，atan2(192, 3.4315E-12)=1.5708弧度，
换算成角度就是180*1.5708/pi=90.0002。可见，相位也是对的。
根据FFT结果以及上面的分析计算，我们就可以写出信号的表达
式了，它就是我们开始提供的信号。

总结：假设采样频率为Fs，采样点数为N，做FFT之后，某
一点n（n从1开始）表示的频率为：Fn=(n-1)*Fs/N；该点的模值
除以N/2就是对应该频率下的信号的幅度（对于直流信号是除以
N）；该点的相位即是对应该频率下的信号的相位。相位的计算
可用函数atan2(b,a)计算。atan2(b,a)是求坐标为(a,b)点的角
度值，范围从-pi到pi。要精确到xHz，则需要采样长度为1/x秒
的信号，并做FFT。要提高频率分辨率，就需要增加采样点数，
这在一些实际的应用中是不现实的，需要在较短的时间内完成
分析。解决这个问题的方法有频率细分法，比较简单的方法是
采样比较短时间的信号，然后在后面补充一定数量的0，使其长度
达到需要的点数，再做FFT，这在一定程度上能够提高频率分辨力。
